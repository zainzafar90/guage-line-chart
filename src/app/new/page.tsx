"use client";

import { useEffect, useState } from "react";
import { ResponsiveContainer } from "recharts";

const backgrounds = [
  // Yellow
  "radial-gradient(circle, rgba(55, 49, 25,1) 0%,  rgba(55, 49, 25,0.5) 50%, rgba(55, 49, 25,0.1) 100%)",
  // Orange
  "radial-gradient(circle, rgba(55, 35, 23,1) 0%,  rgba(55, 35, 23,0.5) 50%, rgba(55, 35, 23,0.1) 100%)",
  // Red
  "radial-gradient(circle, rgba(55, 23, 23,1) 0%,  rgba(55, 23, 23,0.5) 50%, rgba(55, 23, 23,0.1) 100%)",
];

const colors = [
  // Yellow
  "rgba(251, 233, 71, 1)",
  // Orange
  "rgba(255, 144, 62, 1)",
  // Red
  "rgba(255, 90, 90, 1)",
];

const getActiveIndex = (value: number) => {
  if (value >= 0 && value <= 40) {
    return 0;
  } else if (value > 40 && value <= 80) {
    return 1;
  } else if (value > 80 && value <= 120) {
    return 2;
  }

  return 0;
};

export default function Home() {
  const MAX_VALUE = 120;
  const [value, setValue] = useState<number>(60);

  useEffect(() => {
    const interval = setInterval(() => {
      setValue(Math.floor(Math.random() * MAX_VALUE));
    }, 1000);
    return () => clearInterval(interval);
  }, []);

  return (
    <main className="flex min-h-screen flex-col items-center justify-between p-24">
      <div
        className="flex flex-col space-y-4 justify-center p-16"
        style={{
          background: backgrounds[getActiveIndex(value)],
        }}
      >
        <div className="relative min-h-full w-full">
          <div className="mx-auto flex items-center justify-center">
            <ResponsiveContainer width="100%" height="100%">
              <SpeedChart max={MAX_VALUE} value={value} />
            </ResponsiveContainer>
            <span
              className="absolute bottom-9 text-3xl"
              style={{
                color: colors[getActiveIndex(value)],
              }}
            >
              <Counter value={value} />
              <span className=""> &#176;C</span>
            </span>
          </div>
        </div>

        <div className="relative flex flex-col space-y-1 max-w-xs mx-auto">
          <p className="text-center text-lg font-mono">
            <span
              className="font-bold uppercase"
              style={{
                color: colors[getActiveIndex(value)],
              }}
            >
              {value <= 40
                ? "|⠀Low⠀|"
                : value <= 80
                ? "|⠀Medium⠀|"
                : "|⠀High⠀|"}
            </span>
          </p>

          <p className="text-center text-sm opacity-60">
            The temperature is measured in Celsius.
          </p>
        </div>
      </div>
    </main>
  );
}

const Counter = ({ value }: { value: number }) => {
  const [currentValue, setCurrentValue] = useState(0);

  useEffect(() => {
    const interval = setInterval(() => {
      setCurrentValue((prev) => {
        if (prev < value) {
          return prev + 1;
        } else if (prev > value) {
          return prev - 1;
        }
        return prev;
      });
    }, 10);
    return () => clearInterval(interval);
  }, [value]);

  return <span>{currentValue}</span>;
};

const SpeedChart = ({ value, max }: { value: number; max: number }) => {
  const fraction = value / max;
  const angle = fraction * 270 - 210;
  const cx = "100";
  const cy = "100";

  return (
    <svg
      width={294}
      height={294}
      viewBox="0 0 294 294"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M62.1467 231.852C45.3644 215.07 33.9355 193.688 29.3053 170.41C24.6751 147.132 27.0515 123.004 36.134 101.077C45.2165 79.1499 60.5972 60.4084 80.3311 47.2227C100.065 34.0369 123.266 26.999 147 26.999C170.733 26.999 193.934 34.0369 213.668 47.2227C233.402 60.4084 248.783 79.1499 257.865 101.077C266.948 123.004 269.324 147.132 264.694 170.41C260.064 193.688 248.635 215.07 231.852 231.852L197.911 197.911C207.981 187.841 214.838 175.012 217.616 161.046C220.394 147.079 218.968 132.602 213.519 119.446C208.069 106.29 198.841 95.0447 187.001 87.1332C175.16 79.2217 161.24 74.999 147 74.999C132.759 74.999 118.839 79.2217 106.998 87.1332C95.1581 95.0447 85.9297 106.29 80.4802 119.446C75.0307 132.602 73.6048 147.079 76.383 161.046C79.1611 175.012 86.0184 187.841 96.0878 197.911L62.1467 231.852Z"
        fill="url(#paint0_angular_192_4707)"
        fillOpacity="0.2"
      />
      <path
        d="M62.1467 231.852C51.0037 220.709 42.1645 207.48 36.134 192.921C30.1034 178.362 26.9995 162.758 26.9995 146.999C26.9995 131.24 30.1034 115.636 36.134 101.077C42.1645 86.5179 51.0037 73.2892 62.1467 62.1462L65.5408 65.5403C54.8435 76.2376 46.3579 88.9372 40.5686 102.914C34.7793 116.891 31.7995 131.871 31.7995 146.999C31.7995 162.127 34.7792 177.107 40.5686 191.084C46.3579 205.061 54.8435 217.76 65.5408 228.458L62.1467 231.852Z"
        fill="#FBE947"
        opacity={getActiveIndex(value) === 0 ? 1 : 0.5}
      />
      <path
        d="M62.1467 62.1462C84.6511 39.6418 115.174 26.999 146.999 26.999C178.825 26.999 209.348 39.6418 231.852 62.1462L228.458 65.5403C206.854 43.9361 177.552 31.799 146.999 31.799C116.447 31.799 87.145 43.9361 65.5408 65.5403L62.1467 62.1462Z"
        fill="#FF903E"
        opacity={getActiveIndex(value) === 1 ? 1 : 0.5}
      />
      <path
        d="M231.852 62.1462C254.357 84.6506 266.999 115.173 267 146.999C267 178.825 254.357 209.347 231.852 231.852L228.458 228.458C250.062 206.853 262.2 177.552 262.2 146.999C262.199 116.446 250.062 87.1445 228.458 65.5403L231.852 62.1462Z"
        fill="#FF5A5A"
        opacity={getActiveIndex(value) === 2 ? 1 : 0.5}
      />
      <mask
        id="mask0_192_4707"
        style={{ maskType: "luminance" }}
        maskUnits="userSpaceOnUse"
        x={32}
        y={31}
        width={230}
        height={199}
      >
        <path
          d="M66.874 229.491C50.4906 213.577 39.2168 193.146 34.4898 170.8C29.7629 148.455 31.7968 125.208 40.3324 104.023C48.8679 82.8377 63.5185 64.6741 82.4166 51.8473C101.315 39.0206 123.604 32.1116 146.444 32.0011C169.283 31.8906 191.639 38.5837 210.66 51.2271C229.681 63.8705 244.507 81.8915 253.247 102.993C261.987 124.095 264.246 147.321 259.735 169.711C255.225 192.101 244.149 212.641 227.92 228.712L211.736 212.37C224.719 199.513 233.58 183.081 237.188 165.169C240.797 147.256 238.99 128.676 231.998 111.794C225.005 94.9132 213.145 80.4963 197.928 70.3816C182.711 60.2669 164.827 54.9125 146.555 55.0008C128.283 55.0892 110.452 60.6164 95.3333 70.8778C80.2148 81.1393 68.4944 95.6701 61.6659 112.618C54.8374 129.566 53.2103 148.164 56.9919 166.04C60.7734 183.916 69.7924 200.262 82.8992 212.993L66.874 229.491Z"
          fill="white"
        />
      </mask>
      <g mask="url(#mask0_192_4707)">
        <circle
          opacity="0.6"
          cx={147}
          cy={147}
          r={113}
          stroke="white"
          strokeOpacity="0.6"
          strokeWidth={4}
          strokeDasharray="1 10"
        />
        <circle
          cx={147}
          cy={147}
          r={111}
          stroke="white"
          strokeOpacity="0.6"
          strokeWidth={8}
          strokeDasharray="2 48"
        />
      </g>
      <path
        d="M76.336 217.156C78.004 217.156 79.072 215.632 79.072 212.572C79.072 209.524 78.004 208.036 76.336 208.036C74.656 208.036 73.588 209.512 73.588 212.572C73.588 215.632 74.656 217.156 76.336 217.156ZM76.336 216.28C75.328 216.28 74.656 215.164 74.656 212.572C74.656 210.004 75.328 208.924 76.336 208.924C77.332 208.924 78.004 210.004 78.004 212.572C78.004 215.164 77.332 216.28 76.336 216.28Z"
        fill="white"
        fillOpacity="0.6"
      />
      <path
        d="M47.528 151H53.06V150.052H50.624C50.18 150.052 49.64 150.1 49.184 150.136C51.248 148.18 52.628 146.392 52.628 144.64C52.628 143.068 51.644 142.036 50.072 142.036C48.956 142.036 48.2 142.552 47.48 143.332L48.116 143.956C48.596 143.38 49.22 142.936 49.94 142.936C51.032 142.936 51.56 143.668 51.56 144.676C51.56 146.188 50.288 147.94 47.528 150.352V151ZM56.9923 151.156C58.6603 151.156 59.7283 149.632 59.7283 146.572C59.7283 143.524 58.6603 142.036 56.9923 142.036C55.3123 142.036 54.2443 143.512 54.2443 146.572C54.2443 149.632 55.3123 151.156 56.9923 151.156ZM56.9923 150.28C55.9843 150.28 55.3123 149.164 55.3123 146.572C55.3123 144.004 55.9843 142.924 56.9923 142.924C57.9883 142.924 58.6603 144.004 58.6603 146.572C58.6603 149.164 57.9883 150.28 56.9923 150.28Z"
        fill="white"
        fillOpacity="0.6"
      />
      <path
        d="M74.38 81.6998L76.384 78.6998C76.636 78.2678 76.876 77.8358 77.092 77.4038H77.14C77.116 77.8598 77.068 78.5678 77.068 78.9998V81.6998H74.38ZM79.276 81.6998H78.112V76.2038H76.9L73.24 81.8558V82.5758H77.068V84.9998H78.112V82.5758H79.276V81.6998ZM82.9923 85.1558C84.6603 85.1558 85.7283 83.6318 85.7283 80.5718C85.7283 77.5238 84.6603 76.0358 82.9923 76.0358C81.3123 76.0358 80.2443 77.5118 80.2443 80.5718C80.2443 83.6318 81.3123 85.1558 82.9923 85.1558ZM82.9923 84.2798C81.9843 84.2798 81.3123 83.1638 81.3123 80.5718C81.3123 78.0038 81.9843 76.9238 82.9923 76.9238C83.9883 76.9238 84.6603 78.0038 84.6603 80.5718C84.6603 83.1638 83.9883 84.2798 82.9923 84.2798Z"
        fill="white"
        fillOpacity="0.6"
      />
      <path
        d="M143.612 57.3038C142.508 57.3038 141.848 56.3078 141.716 54.4838C142.292 53.6678 142.964 53.3558 143.516 53.3558C144.584 53.3558 145.1 54.1118 145.1 55.2998C145.1 56.4998 144.452 57.3038 143.612 57.3038ZM145.976 49.9358C145.496 49.4198 144.836 49.0358 143.924 49.0358C142.22 49.0358 140.672 50.3558 140.672 53.7998C140.672 56.7038 141.92 58.1558 143.612 58.1558C144.98 58.1558 146.132 57.0038 146.132 55.2998C146.132 53.4638 145.184 52.5398 143.696 52.5398C143 52.5398 142.232 52.9478 141.692 53.6078C141.74 50.8718 142.76 49.9478 143.96 49.9478C144.5 49.9478 145.028 50.1998 145.376 50.6198L145.976 49.9358ZM149.992 58.1558C151.66 58.1558 152.728 56.6318 152.728 53.5718C152.728 50.5238 151.66 49.0358 149.992 49.0358C148.312 49.0358 147.244 50.5118 147.244 53.5718C147.244 56.6318 148.312 58.1558 149.992 58.1558ZM149.992 57.2798C148.984 57.2798 148.312 56.1638 148.312 53.5718C148.312 51.0038 148.984 49.9238 149.992 49.9238C150.988 49.9238 151.66 51.0038 151.66 53.5718C151.66 56.1638 150.988 57.2798 149.992 57.2798Z"
        fill="white"
        fillOpacity="0.6"
      />
      <path
        d="M210.348 85.1558C212.004 85.1558 213.108 84.1598 213.108 82.8758C213.108 81.6758 212.388 81.0158 211.62 80.5718V80.5118C212.148 80.1038 212.796 79.3118 212.796 78.3878C212.796 77.0318 211.884 76.0718 210.384 76.0718C209.004 76.0718 207.972 76.9598 207.972 78.3038C207.972 79.2278 208.512 79.8878 209.16 80.3318V80.3918C208.356 80.8238 207.54 81.6398 207.54 82.8158C207.54 84.1718 208.728 85.1558 210.348 85.1558ZM210.948 80.2238C209.916 79.8158 208.968 79.3598 208.968 78.3038C208.968 77.4518 209.556 76.8758 210.36 76.8758C211.308 76.8758 211.86 77.5838 211.86 78.4478C211.86 79.0958 211.548 79.6958 210.948 80.2238ZM210.372 84.3398C209.316 84.3398 208.536 83.6558 208.536 82.7198C208.536 81.8798 209.028 81.1838 209.736 80.7278C210.984 81.2318 212.064 81.6758 212.064 82.8518C212.064 83.7278 211.38 84.3398 210.372 84.3398ZM216.992 85.1558C218.66 85.1558 219.728 83.6318 219.728 80.5718C219.728 77.5238 218.66 76.0358 216.992 76.0358C215.312 76.0358 214.244 77.5118 214.244 80.5718C214.244 83.6318 215.312 85.1558 216.992 85.1558ZM216.992 84.2798C215.984 84.2798 215.312 83.1638 215.312 80.5718C215.312 78.0038 215.984 76.9238 216.992 76.9238C217.988 76.9238 218.66 78.0038 218.66 80.5718C218.66 83.1638 217.988 84.2798 216.992 84.2798Z"
        fill="white"
        fillOpacity="0.6"
      />
      <path
        d="M228.056 151H232.88V150.088H231.116V142.204H230.276C229.796 142.48 229.232 142.684 228.452 142.828V143.524H230.012V150.088H228.056V151ZM236.992 151.156C238.66 151.156 239.728 149.632 239.728 146.572C239.728 143.524 238.66 142.036 236.992 142.036C235.312 142.036 234.244 143.512 234.244 146.572C234.244 149.632 235.312 151.156 236.992 151.156ZM236.992 150.28C235.984 150.28 235.312 149.164 235.312 146.572C235.312 144.004 235.984 142.924 236.992 142.924C237.988 142.924 238.66 144.004 238.66 146.572C238.66 149.164 237.988 150.28 236.992 150.28ZM243.649 151.156C245.317 151.156 246.385 149.632 246.385 146.572C246.385 143.524 245.317 142.036 243.649 142.036C241.969 142.036 240.901 143.512 240.901 146.572C240.901 149.632 241.969 151.156 243.649 151.156ZM243.649 150.28C242.641 150.28 241.969 149.164 241.969 146.572C241.969 144.004 242.641 142.924 243.649 142.924C244.645 142.924 245.317 144.004 245.317 146.572C245.317 149.164 244.645 150.28 243.649 150.28Z"
        fill="white"
        fillOpacity="0.6"
      />
      <path
        d="M202.056 217H206.88V216.088H205.116V208.204H204.276C203.796 208.48 203.232 208.684 202.452 208.828V209.524H204.012V216.088H202.056V217ZM208.184 217H213.716V216.052H211.28C210.836 216.052 210.296 216.1 209.84 216.136C211.904 214.18 213.284 212.392 213.284 210.64C213.284 209.068 212.3 208.036 210.728 208.036C209.612 208.036 208.856 208.552 208.136 209.332L208.772 209.956C209.252 209.38 209.876 208.936 210.596 208.936C211.688 208.936 212.216 209.668 212.216 210.676C212.216 212.188 210.944 213.94 208.184 216.352V217ZM217.649 217.156C219.317 217.156 220.385 215.632 220.385 212.572C220.385 209.524 219.317 208.036 217.649 208.036C215.969 208.036 214.901 209.512 214.901 212.572C214.901 215.632 215.969 217.156 217.649 217.156ZM217.649 216.28C216.641 216.28 215.969 215.164 215.969 212.572C215.969 210.004 216.641 208.924 217.649 208.924C218.645 208.924 219.317 210.004 219.317 212.572C219.317 215.164 218.645 216.28 217.649 216.28Z"
        fill="white"
        fillOpacity="0.6"
      />
      <path
        d="M145.965 143.136L204.956 131.471L148.035 150.864L145.965 143.136Z"
        fill={
          getActiveIndex(value) === 0
            ? "#FBE947"
            : getActiveIndex(value) === 1
            ? "#FF903E"
            : "#FF5A5A"
        }
        id="needle"
        className="transition-transform duration-500"
        style={{
          transformOrigin: "50% 50%",
          transform: `rotate(${angle}deg)`,
        }}
      />
      <g filter="url(#filter0_d_192_4707)">
        <ellipse
          cx={147}
          cy={147}
          rx={8}
          ry={8}
          transform="rotate(-15 147 147)"
          fill="#051D28"
        />
        <path
          d="M153.279 145.318C154.208 148.785 152.15 152.349 148.682 153.278C145.215 154.208 141.651 152.15 140.722 148.682C139.792 145.215 141.85 141.65 145.318 140.721C148.785 139.792 152.35 141.85 153.279 145.318Z"
          stroke="white"
          strokeWidth={3}
        />
      </g>
      <defs>
        <filter
          id="filter0_d_192_4707"
          x="130.998"
          y="130.998"
          width="32.0039"
          height="32.0042"
          filterUnits="userSpaceOnUse"
          colorInterpolationFilters="sRGB"
        >
          <feFlood floodOpacity={0} result="BackgroundImageFix" />
          <feColorMatrix
            in="SourceAlpha"
            type="matrix"
            values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
            result="hardAlpha"
          />
          <feOffset />
          <feGaussianBlur stdDeviation={4} />
          <feComposite in2="hardAlpha" operator="out" />
          <feColorMatrix
            type="matrix"
            values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.4 0"
          />
          <feBlend
            mode="normal"
            in2="BackgroundImageFix"
            result="effect1_dropShadow_192_4707"
          />
          <feBlend
            mode="normal"
            in="SourceGraphic"
            in2="effect1_dropShadow_192_4707"
            result="shape"
          />
        </filter>
        <radialGradient
          id="paint0_angular_192_4707"
          cx={0}
          cy={0}
          r={1}
          gradientUnits="userSpaceOnUse"
          gradientTransform="translate(147 146.999) rotate(90) scale(120)"
        >
          <stop stopColor="#FBE947" />
          <stop offset={1} stopColor="#FF5A5A" />
        </radialGradient>
      </defs>
    </svg>
  );
};
